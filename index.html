<!doctype html>
<html lang="en">
  <head>
    <title>Tullio Gul√¨ - Game developer</title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./assets/css/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="shortcut icon"
      href="./assets/images/logo.ico"
      type="image/x-icon"
    />
  </head>

  <body>
    <main>
      <!-- #SIDEBAR -->
      <div data-include="sections/sidebar.html"></div>

      <div class="main-content">
        <!-- #NAVBAR -->
        <div data-include="sections/navbar.html"></div>

        <!-- #ABOUT -->
        <div data-include="pages/about.html"></div>

        <!-- #RESUME -->
        <div data-include="pages/resume.html"></div>

        <!-- #SKILLS -->
        <div data-include="pages/skills.html"></div>

        <!-- #PORTFOLIO -->
        <div data-include="pages/portfolio.html"></div>

        <!-- projects modal -->
        <div class="modal-container" data-modal-projects-container>
          <div class="overlay" data-modal-projects-overlay></div>

          <section class="content-modal">
            <button class="modal-close-btn" data-modal-projects-close-btn>
              <ion-icon name="close-outline"></ion-icon>
            </button>
            <div class="modal-content">
              <figure class="modal-img">
                <img src="" data-modal-projects-img />
              </figure>
              <h4 class="h3 modal-title" data-modal-projects-title>TITLE</h4>
              <div class="modal-subtitle" data-modal-projects-made>TEXT</div>
              <time data-modal-projects-time>TIME</time>
              <div class="modal-text" data-modal-projects-text>TEXT</div>
            </div>
          </section>
        </div>

        <!-- #Links -->
        <div data-include="pages/links.html"></div>

        <!-- #CONTACT -->
        <!-- Not used, maybe in the future
        <div data-include="pages/contact.html"></div>
        -->
      </div>
    </main>

    <!--
    - custom js link
  -->

    <!--
    - ionicon link
  -->
    <script
      type="module"
      src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule
      src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"
    ></script>
    <script>
      function includeHTML() {
        const elements = document.querySelectorAll("[data-include]")
        const fetchPromises = []
        elements.forEach((el) => {
          const file = el.getAttribute("data-include")
          const fetchPromise = fetch(file)
            .then((response) => {
              if (response.ok) return response.text()
              return Promise.reject("File not found")
            })
            .then((data) => {
              el.innerHTML = data
            })
          fetchPromises.push(fetchPromise)
        })

        // Quando tutti i fetch sono completati
        Promise.all(fetchPromises)
          .then(() => {
            console.log("All files sections and pages are loaded")
            const elements = document.querySelectorAll("[data-project-include]")
            const fetchProjects = []
            elements.forEach((el) => {
              const file = el.getAttribute("data-project-include")
              const fetchProject = fetch(file)
                .then((response) => {
                  if (response.ok) return response.text()
                  return Promise.reject("File not found")
                })
                .then((data) => {
                  el.innerHTML = data
                })
              fetchProjects.push(fetchProject)
            })

            Promise.all(fetchProjects)
              .then(() => {
                console.log("All files project are loaded")
                const script = document.createElement("script")
                script.src = "./assets/js/script.js"
                script.onload = () => {
                  console.log("Main script loaded after all fetches")
                }
                document.body.appendChild(script)
              })
              .catch((error) => {
                console.error(
                  "Errore durante il caricamento di uno dei file:",
                  error,
                )
              })
          })
          .catch((error) => {
            console.error(
              "Errore durante il caricamento di uno dei file:",
              error,
            )
          })
      }
      document.addEventListener("DOMContentLoaded", includeHTML)
    </script>
  </body>
</html>
